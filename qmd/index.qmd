---
title: "서울시 치안데이터 분석"
# subtitle: "부제목입니다."
# author: "2조"
format: 
  revealjs:
    highlight-style: gruvbox
    incremental: true  
    code-line-numbers: true
    language: ko
    # logo: logo.png
    css: styles.css
    title-slide-attributes: 
      data-background-image: "img/title-bg.png"
      data-background-size: cover
    slide-attributes:
      # data-background-image: "assets/bg.png"
      data-background-size: cover
jupyter: python3
---



## {data-background-image="img/default-bg.png"}
<div>
<p style="position:absolute; top:0px;"></p>
<p style="margin-top:300px; margin-left:300px; font-size: 56px;">"CCTV가 많으면 범죄율을 <br/> 낮추는 데에 도움이 될까요?"</p>

<img src = "img/police.png"
  style="position: absolute; top: 100px; left:-80px; width: 300px;"
/>
</div>







---

## {data-background-image="img/list-bg.png"}



---

## {data-background-image="img/data-bg.png"}
<p style="font-size: 18px;
    position: absolute;
    bottom: -20px;
    color: #9ca3af !important;">출처: 서울시 공공데이터포털 (https://data.seoul.go.kr/)</p>










---

## {data-background-image="img/default-bg.png"}

::::{.columns}

<h6 style="margin-bottom: 40px;">데이터 살펴보기</h6>

:::{.column width="50%"}
```{python}
#|eval: true
#|echo: false
# 인구 데이터
# 생활 인구수 지도 시각화
import pandas as pd
import numpy as np
import plotly.express as px
import json

with open('../data/seoul_districts.geojson', encoding='utf-8') as f:
    geojson_data = json.load(f)

master = pd.read_excel('../data/sanggwan_df.xlsx')
master.columns

fig = px.choropleth_mapbox(
    master,
    geojson=geojson_data,
    locations='자치구',                        # 지역 이름
    featureidkey='properties.SIG_KOR_NM',     
    color='총생활인구수',                         # 시각화에 사용할 값
    color_continuous_scale='Blues',            # 색상 스케일
    hover_name='자치구',
    hover_data={'총생활인구수': True},
    mapbox_style='carto-positron',
    center={'lat': 37.5665, 'lon': 126.9780},  # 서울 중심
    zoom=9,
    opacity=0.7,
    title='서울시 자치구별 구별 총생활인구수 시각화'
)

# 레이아웃 조정
fig.update_layout(
    margin={"r": 0, "t": 30, "l": 0, "b": 0},
    height=400,
    width=500
)

fig.show()

print("TOP 3")
print(master.sort_values(ascending=False, by="총생활인구수").loc[:, ['자치구', '총생활인구수']].head(3))


```

:::

:::{.column width="50%"}
```{python}
#|eval: true
#|echo: false


# 1인 가구 수 지도 시각화
master = pd.read_excel('../data/sanggwan_df.xlsx')
master.columns

fig = px.choropleth_mapbox(
    master,
    geojson=geojson_data,
    locations='자치구',                        # 지역 이름
    featureidkey='properties.SIG_KOR_NM',     
    color='1인가구수',                         # 시각화에 사용할 값
    color_continuous_scale='Blues',            # 색상 스케일
    hover_name='자치구',
    hover_data={'1인가구수': True},
    mapbox_style='carto-positron',
    center={'lat': 37.5665, 'lon': 126.9780},  # 서울 중심
    zoom=9,
    opacity=0.7,
    title='서울시 자치구별 구별 1인가구수 시각화'
)

# 레이아웃 조정
fig.update_layout(
    margin={"r": 0, "t": 30, "l": 0, "b": 0},
    height=400,
    width=500
)

fig.show()

print("TOP 3")
print(master.sort_values(ascending=False, by="1인가구수").loc[:, ['자치구', '1인가구수']].head(3))



```

:::

::::











---

## {data-background-image="img/default-bg.png"}

<h6 style="margin-bottom: 40px;">데이터 살펴보기</h6>

::::{.columns}

:::{.column width="50%"}

```{python}
#|echo: false
#|eval: true


# 치안 데이터
# CCTV 수 지도 시각화
cctv = pd.read_csv('../data/Seoul_CCTV_info.csv',encoding='cp949')


gu_counts = cctv['자치구'].value_counts().reset_index()
top_3 = cctv['자치구'].value_counts().sort_values(ascending=False).head(3)
gu_counts.columns = ['SIG_KOR_NM', '건수']

# 시각화
fig = px.choropleth_mapbox(
    gu_counts,
    geojson=geojson_data,
    locations="SIG_KOR_NM",
    featureidkey="properties.SIG_KOR_NM",
    color="건수",
    color_continuous_scale="Greens",
    mapbox_style="carto-positron",
    center={"lat": 37.5665, "lon": 126.9780},
    zoom=9,
    opacity=0.7,
    title="서울시 자치구별 CCTV 설치 건수"
)
fig.update_layout(
    margin={"r":0, "t":30, "l":0, "b":0},
    height=300,
    width=500
)

fig.show()

print(top_3)

```


:::



:::{.column width="50%"}
```{python}
#|echo: false
#|eval: true
# 서울 안전벨 수 지도 시각화

bell = pd.read_excel('../data/Seoul_Safetybell.xlsx')

bell['자치구'].value_counts()


gu_counts = bell['자치구'].value_counts().reset_index()
top_3 = bell['자치구'].value_counts().sort_values(ascending=False).head(3)
gu_counts.columns = ['SIG_KOR_NM', '건수']

# 시각화
fig = px.choropleth_mapbox(
    gu_counts,
    geojson=geojson_data,
    locations="SIG_KOR_NM",
    featureidkey="properties.SIG_KOR_NM",
    color="건수",
    color_continuous_scale="Greens",
    mapbox_style="carto-positron",
    center={"lat": 37.5665, "lon": 126.9780},
    zoom=9,
    opacity=0.7,
    title="서울시 자치구별 안심벨 설치 건수"
)
fig.update_layout(
    margin={"r":0, "t":30, "l":0, "b":0},
    height=300,
    width=500
)

fig.show()

print(top_3)

```


:::

::::

```{python}
#|eval: true
#|echo: false
corr = master.select_dtypes('number').corr()['CCTV총수량']['안전벨 수']

print("")
print(f"안전벨과 CCTV의 상관관계: {corr:.4f}")
from scipy.stats import mannwhitneyu
# H0: 총 인구수와 1인 가구수의 중앙값이 같다.
# HA: 총 인구수와 1인 가구수의 중앙값이 다르다.

print("예상과 달리, CCTV와 안전벨의 상관관계가 높지 않다.")

```



---

## {data-background-image="img/default-bg.png"}

<h6 style="margin-bottom: 40px;">데이터 살펴보기</h6>

::::{.columns}

:::{.column width="50%"}
```{python}
#|echo: false
#|eval: true

# 치안 센터 수 지도 시각화
master = pd.read_excel('../data/sanggwan_df.xlsx')
master.columns

fig = px.choropleth_mapbox(
    master,
    geojson=geojson_data,
    locations='자치구',                        # 지역 이름
    featureidkey='properties.SIG_KOR_NM',     
    color='치안센터수',                         # 시각화에 사용할 값
    color_continuous_scale='Greens',            # 색상 스케일
    hover_name='자치구',
    hover_data={'치안센터수': True},
    mapbox_style='carto-positron',
    center={'lat': 37.5665, 'lon': 126.9780},  # 서울 중심
    zoom=9,
    opacity=0.7,
    title='서울시 자치구별 구별 치안센터수 시각화'
)

# 레이아웃 조정
fig.update_layout(
    margin={"r": 0, "t": 30, "l": 0, "b": 0},
    height=350,
    width=500
)

fig.show()


```

:::


:::{.column width="50%"}
```{python}
#|echo: false
#|eval: true


# 경찰관수 지도 시각화
master = pd.read_excel('../data/sanggwan_df.xlsx')
master.columns

fig = px.choropleth_mapbox(
    master,
    geojson=geojson_data,
    locations='자치구',                        # 지역 이름
    featureidkey='properties.SIG_KOR_NM',     
    color='구별 경찰수',                         # 시각화에 사용할 값
    color_continuous_scale='Greens',            # 색상 스케일
    hover_name='자치구',
    hover_data={'구별 경찰수': True},
    mapbox_style='carto-positron',
    center={'lat': 37.5665, 'lon': 126.9780},  # 서울 중심
    zoom=9,
    opacity=0.7,
    title='서울시 자치구별 구별 경찰수 시각화'
)

# 레이아웃 조정
fig.update_layout(
    margin={"r": 0, "t": 30, "l": 0, "b": 0},
    height=350,
    width=500
)

fig.show()

```

:::


::::


```{python}
#|echo: false
#|eval: true

# 치안센터 수, 경찰관 수 상관관계
corr_2 = master.select_dtypes('number').corr()['치안센터수']['구별 경찰수']
print("")
print(f"치안센터와 경찰관 수의 상관관계: {corr_2:.4f}")
print("다른 변수들과 비교했을 때 가장 높은 상관관계를 보임")
# 0.65004
# 역시나 강한 상관관게를 보인다. 다른 변수들과 비교했을 때 가장 높은 상관관계

```






---

## {data-background-image="img/default-bg.png"}

<h6 style="margin-bottom: 40px;">데이터 살펴보기</h6>

::::{.columns}


:::{.column width="50%"}
```{python}
#|echo: false
#|eval: true

# 상권 데이터
# 술집 수 지도 시각화
master = pd.read_excel('../data/sanggwan_df.xlsx')
master.columns

fig = px.choropleth_mapbox(
    master,
    geojson=geojson_data,
    locations='자치구',                        # 지역 이름
    featureidkey='properties.SIG_KOR_NM',     
    color='술집 수',                         # 시각화에 사용할 값
    color_continuous_scale='OrRd',            # 색상 스케일
    hover_name='자치구',
    hover_data={'술집 수': True},
    mapbox_style='carto-positron',
    center={'lat': 37.5665, 'lon': 126.9780},  # 서울 중심
    zoom=9,
    opacity=0.7,
    title='서울시 자치구별 구별 술집 수 시각화'
)

# 레이아웃 조정
fig.update_layout(
    margin={"r": 0, "t": 30, "l": 0, "b": 0},
    height=500,
    width=500
)

fig.show()

top_3 = master.sort_values('술집 수',ascending=True).loc[:, ['자치구', '술집 수']].head(3)
print(top_3)

```

:::

:::{.column width="50%"}
```{python}
#|echo: false
#|eval: true


# 범죄 데이터
# 서울 범죄 수 지도 시각화
master = pd.read_excel('../data/sanggwan_df.xlsx')
master.columns

fig = px.choropleth_mapbox(
    master,
    geojson=geojson_data,
    locations='자치구',                        # 지역 이름
    featureidkey='properties.SIG_KOR_NM',     
    color='총범죄건수',                         # 시각화에 사용할 값
    color_continuous_scale='YlOrRd',            # 색상 스케일
    hover_name='자치구',
    hover_data={'총범죄건수': True},
    mapbox_style='carto-positron',
    center={'lat': 37.5665, 'lon': 126.9780},  # 서울 중심
    zoom=9,
    opacity=0.7,
    title='서울시 자치구별 총범죄건수 시각화'
)

# 레이아웃 조정
fig.update_layout(
    margin={"r": 0, "t": 30, "l": 0, "b": 0},
    height=500,
    width=500
)

fig.show()
top_3 = master.sort_values('총범죄건수',ascending=True).loc[:, ['자치구', '술집 수']].head(3)
print(top_3)

```

:::


::::

```{python}
#|echo: false
#|eval: true

# 술집 수, 총범죄건수 상관관계
corr = master.select_dtypes('number').corr()['술집 수']['총범죄건수']
print("")
print(f"술집 수와 총 범죄 건수의 상관계수: {corr:.4f}")
print("다른 변수들과 비교했을 때, 가장 높은 상관관계를 보임")
# 0.83537
# 역시나 아주 강한 상관관게를 보인다. 
# 다른 변수들과 비교했을 때 가장 높은 상관관계



```
















---

## {data-background-image="img/default-bg.png"}

:::::{.columns}

:::{.column width="60%"}
상관계수 분석
```{python}
#|echo: false
#|eval: true
import pandas as pd
import matplotlib.pyplot as plt
merged_df= pd.read_excel('../data/sanggwan_df.xlsx')
merged_df = merged_df.drop(columns=['범죄율'])
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# 상관계수 
corr_df = merged_df.drop(columns=["자치구"]).corr()
corr_df 

# 히트맵
import seaborn as sns
plt.rcParams['font.family'] ='Malgun Gothic'
plt.rcParams['axes.unicode_minus'] =False

plt.figure(figsize=(8, 6))
sns.heatmap(corr_df, annot=True, cmap="coolwarm", fmt=".2f")
plt.title("서울시 자치구별 변수 간 상관관계")
plt.xticks(rotation=45)  
plt.tight_layout()
plt.show()

```
:::

:::{.column width="40%"}
<p style="margin-top:90px;">범죄건수 주요 변수</p>

- 술집 수
- 생활 인구 수
- 구별 경찰 수
- CCTV 총 수량
- 1인가구수
:::
:::::


---

## {data-background-image="img/default-bg.png"}

<h6 style="margin-top: 30px;">회귀분석</h6>

:::::{.columns}
:::{.column width="50%"}
```{python}
#|echo: false
#|eval: true
import pandas as pd
import matplotlib.pyplot as plt
merged_df= pd.read_excel('../data/sanggwan_df.xlsx')
merged_df = merged_df.drop(columns=['범죄율'])
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# 상관계수 
corr_df = merged_df.drop(columns=["자치구"]).corr()
corr_df 

# 히트맵
import seaborn as sns
plt.rcParams['font.family'] ='Malgun Gothic'
plt.rcParams['axes.unicode_minus'] =False

plt.figure(figsize=(6, 4))
sns.heatmap(corr_df, annot=True, cmap="coolwarm", fmt=".2f")
plt.title("서울시 자치구별 변수 간 상관관계")
plt.xticks(rotation=45)  
plt.tight_layout()
plt.show()

```

상관 관계 높은 변수 임의 선택

:::

:::{.column width="50%"}

<img src="https://logoarena-storage.s3.amazonaws.com/contests/public/5601/11006_1425290467_stepwise04.png"/>

<p style="margin-top:90px;"><span style="color:#ef4444 !important;">VS</span>   Stepwise로 변수 선택</p>

:::


:::::











---

## {data-background-image="img/default-bg.png"}

<p style="text-align: center;
    margin-top: 50px;
    font-size: 52px;">서울시 치안 기준 군집화</p>

<p>상관계수가 높은 변수를 활용해서,</p>

<p>비슷한 치안 특성을 가진 구를 찾기위해</p>
<p>저희는 K-Means 클러스터링을 사용했습니다.</p>

<img src="img/k-means-ex.png"/>


---

## {data-background-image="img/default-bg.png"}


<p>K-Means 클러스터링이란?</p>

:::{.fragment}

<p>유사한 특성을 가진 데이터를 자동으로 그룹으로 묶는 비지도 학습 기법</p>

:::


- 사용자가 군집 개수(K)를 정하면,

- K개의 중심점을 기준으로 데이터를 그룹화하고,

- 각 데이터를 가장 가까운 중심점에 할당합니다.

- 중심점을 반복적으로 조정하며 유사한 데이터끼리 묶는 군집을 만듭니다.


:::{.fragment}

<p>서울시 자치구별 '구별_경찰수', '유흥업소_개수', '총생활인구수', 'cctv' 등을 기준으로
치안 특성이 비슷한 지역을 자동으로 군집화하기 위해 사용했습니다.</p>

:::



















---

## {data-background-image="img/default-bg.png"}

<div style="width:100%;">
  <img src="img/cctv-news.png" style="margin-top: 30px; width: 50%;"/>

  <p style="text-align: center;">하지만 분석 결과는...?</p>

  <img src="img/yellow.png" style="margin-top: 30px; position:absolute; bottom:0px; margin-top: 30px; position:absolute; bottom: 0px; right: 0px; width: 40%;"/>

</div>

--- 

## {data-background-image="img/result-bg.png"}




---

## {data-background-image="img/final-bg.png"}
